<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dbmapper">
	<select id="select_top10" resultType="getset.H_getset">
		SELECT
		h_hotel.h_pho,
		h_hotel.country_ko,
		h_hotel.city_ko,
		h_hotel.h_name_ko,
		h_hotel.h_name_eng,
		COUNT(h_room.h_name_eng) AS room_count
		FROM
		h_reserve
		INNER JOIN
		h_room ON h_reserve.h_roomnum = h_room.h_roomnum
		INNER JOIN
		h_hotel ON h_room.h_name_eng = h_hotel.h_name_eng
		GROUP BY
		h_hotel.h_pho,
		h_hotel.country_ko,
		h_hotel.city_ko,
		h_hotel.h_name_ko,
		h_hotel.h_name_eng
		ORDER BY
		room_count DESC
		LIMIT 10;
	</select>

	<select id="select_ukAll" resultType="getset.H_getset"
		parameterType="getset.H_getset">
		SELECT
		h_hotel.*,
		MIN(h_room.h_roompri) AS min_h_roompri
		FROM
		h_hotel
		INNER JOIN
		h_room
		ON
		h_hotel.h_name_eng = h_room.h_name_eng
		WHERE
		h_hotel.country_eng = #{country_list}
		GROUP BY
		h_hotel.h_name_eng;
	</select>


	<select id="select_top10_info" resultType="getset.H_getset" parameterType="getset.H_getset">
(
  SELECT h_room.*, h_hotel.*
  FROM h_room
  INNER JOIN h_hotel ON h_room.h_name_eng = h_hotel.h_name_eng
  WHERE h_room.h_name_eng = '${h_name_eng}'  -- 변수를 따옴표로 둘러싸서 문자열로 처리
    AND h_room.h_roomtype = 'double'
  ORDER BY RAND()
  LIMIT 1
) 
UNION
(
  SELECT h_room.*, h_hotel.*
  FROM h_room
  INNER JOIN h_hotel ON h_room.h_name_eng = h_hotel.h_name_eng
  WHERE h_room.h_name_eng = '${h_name_eng}'  -- 변수를 따옴표로 둘러싸서 문자열로 처리
    AND h_room.h_roomtype = 'suite'
  ORDER BY RAND()
  LIMIT 1
);
	</select>



</mapper>